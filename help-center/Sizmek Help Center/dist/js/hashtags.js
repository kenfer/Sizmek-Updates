$(document).ready(function(){var a=HelpCenter.user.role,t=(window.location.href.split("--")[0],"https://support.sizmek.com/hc/en-us/articles/360004850231-Hashtag-Management"),n=[];if(-1!==jQuery.inArray("view_support_content",HelpCenter.user.tags)&&$("#user-menu").append("<a id='hashAdmin' role='menuitem' href='"+t+"'>Hashtag Management</a>"),-1<window.location.href.indexOf("/articles/")&&"end_user"!=a&&"anonymous"!=a){var s,i,d=window.location.href.split("articles/")[1].split("#")[0].split("-")[0].split("?")[0];console.log("test"),console.log(HelpCenter.user.tags),-1!==jQuery.inArray("view_support_content",HelpCenter.user.tags)&&($.get("/api/v2/help_center/articles/"+d+".json",function(a){i=a.article.section_id,$.get("/api/v2/help_center/sections/"+i+".json",function(a){l(s=a.section.category_id,i)})}),$(".article-wrapper").prepend('<div class="incident-wrapper"></div>'),$(".incident-wrapper").prepend('<div class="article-hashtags"></div>'),$("body").on("click","#hashBtn",function(){var a,t=[];$("#hashTxt").toggle("fast"),$("#hashTxt").focus(),""!=(a=$("#hashTxt").val().replace(/\s/g,""))&&(t.push(a),$("#hashTxt").val(""));for(var e=0;e<t.length;e++)$.ajax({url:"/api/v2/help_center/articles/"+d+"/labels.json",type:"POST",data:{label:{name:"Tags:"+t[e]}},success:function(){$(".tagList").remove(),$(".tagList").html(l(s,i)),$("#hashTxt").css("display","inline-block").focus()}})}),$("body").keypress(function(a){if(13===a.which&&"inline-block"===$("#hashTxt").css("display"))return $("#hashBtn").trigger("click"),!1}),$("body").on("click",".cssCircle.minusSign",function(a){a.stopPropagation();var t=$(this).find("span.hide").text();$("#query").val(""),$.ajax({url:"/api/v2/help_center/articles/"+d+"/labels/"+t+".json",type:"DELETE",success:function(){$(".tagList").remove(),$(".tagList").html(l(s,i))}})}),$("body").on("click","a.hashTags",function(){var a=$(this).find(".tagName:first").text();$("#query").val(a),$("#query").focus(),window.location.href="https://support.sizmek.com/hc/en-us/search?utf8=%E2%9C%93&query="+encodeURIComponent(a)+"&commit=Search"}),window.location.href==t&&(console.log("window.location.href == hashtagAdminURL"),$(".incident-wrapper, article").hide(),$("#main-wrap").append('<section class="hashtag-management"><div class="hashtag-count"></div><div class="hashtag-sorting"><label for="hashtag-select">Sort By: </label><select id="hashtag-select"><option value="1">Alphabet</option><option value="2">Number of Tags</option><option value="3">Latest Update</option></select></div><div><ul class="hashtag-list"></ul></div><div id="add-hashtag-modal" class="modal"><div class="modal-content"><div class="hashtag-modal-header"> <h4>Add hashtag</h4><span class="hashtag-close-modal">&times;</span></div><div class="hashtag-modal-body"> <form> <div> <label>Hashtag</label> <input id="add-hashtag-input" spellcheck="false"> <p></p></div></form> </div><div class="hashtag-modal-footer"> <button id="cancel-add-hashtag"><span>Cancel</span></button> <button id="save-hashtag-button" ><span>OK</span></button> </div></div></div><div id="edit-hashtag-modal" class="modal"> <div class="modal-content"> <div class="hashtag-modal-header"> <h4>Edit hashtag</h4><span class="hashtag-close-modal">&times;</span> </div><div class="hashtag-modal-body"> <form> <div> <label>Hashtag</label> <input id="edit-hashtag-input" spellcheck="false"> <p></p></div></form> </div><div class="hashtag-modal-footer"> <button id="cancel-edit-hashtag"><span>Cancel</span></button> <button id="edit-hashtag-button"><span>OK</span></button> </div></div></div><div id="delete-hashtag-modal" class="modal"> <div class="modal-content"> <div class="hashtag-modal-header"> <h4>Delete hashtag</h4><span class="hashtag-close-modal">&times;</span> </div><div class="hashtag-modal-body"> <form> <h4>Do you want to delete this hashtag?</h4> </form> </div><div class="hashtag-modal-footer"> <button id="cancel-delete-hashtag"><span>Cancel</span></button> <button id="delete-hashtag-button"><span>OK</span></button> </div></div></div></section>'),$('<div class="hashtagHeader"></div>').insertAfter(".article-info"),$('<div class="hashtagList body"></div>').insertAfter(".hashtagHeader"),$(".hashtagHeader").append("<div class='searchContainer' style='float: right;'><input id='sortTagBtn' type='button' value='Sort tags by...'></div>"),$(".searchContainer").append("<div class='sortOptions' style='display: none;'></div>"),$.get("/api/v2/help_center/articles/labels").done(function(a){n=a.labels;var t=new c;setTimeout(function(){n.forEach(function(a){"Tags:"===a.name.substr(0,5)&&"Tags:"!==a.name&&t.add(a)});var a=new o(t);a.render(),a.initEvents()},2e3)}),$("body").on("change","#hashtag-select",function(){console.log($(this).val())}),$("body").on("click",".h3Tag",e),$("body").keypress(function(a){if(13===a.which&&1==$("#searchTag").is(":focus")&&""!=$("#searchTag").val()){var t=$(".tag-"+$("#searchTag").val());return $("html,body").animate({scrollTop:t.offset().top},500),$("body").on("click",".h3Tag",e),!1}})))}function l(l,a){var i,o=[];$(".article-hashtags").append('<div class="tagList"><a id="hashBtn" style="font-weight: bold;">+</a><input list="recoHashtag" type="text" id="hashTxt" placeholder="Enter a term, keyword or tag..." style="display: none; margin: 0px 7px;"><datalist id="recoHashtag"></datalist></div>'),$(".article-body.markdown p").append('<div class="hidden-tags hide"><ul></ul></div>'),$.get("/api/v2/help_center/articles/"+d+"/labels.json",function(e){var a=1,t=window.localStorage,s=window.location.href.split("?currArticleId=")[1];if(-1<window.location.href.indexOf("/208223316")&&null!==t.getItem(HelpCenter.user.email+"-previewLabels"+s)){var n=t.getItem(HelpCenter.user.email+"-previewLabels"+s).split(",");e.labels=[],$.each(n,function(a,t){e.labels.push({name:t})})}for(var i=0;i<e.labels.length;i++)"Tags:"==e.labels[i].name.substr(0,5)&&($('<a class="hashTags" id="hash-'+a+'"><div class="cssCircle minusSign" style="display: none; background: #ff0000;">&#8211;<span class="hide">'+e.labels[i].id+'</span></div><div class="tagName">#'+e.labels[i].name.substr(5)+'</div><span class="hide">'+l+"</span></a>").insertAfter("#recoHashtag"),$(".hidden-tags ul").append("<li>"+e.labels[i].name+"</li>"),a++,o.push(e.labels[i].name.substr(5).toLowerCase()))}),i=o,$.get("/api/v2/help_center/categories/"+s+"/articles.json?sort_by=updated_at&sort_order=desc",function(a){for(var t=[],e=0;e<a.articles.length;e++)for(var s=0;s<a.articles[e].label_names.length;s++)"Tags:"==a.articles[e].label_names[s].substr(0,5)&&t.push(a.articles[e].label_names[s].substr(5).toLowerCase());var t=t.filter(function(a){return!this.has(a)},new Set(i)),n=[];$.each(t,function(a,t){-1==$.inArray(t,n)&&n.push(t)});for(var e=0;e<n.length;e++)$("#recoHashtag").append('<option value="'+n[e]+'"/>')})}function e(){var a=$(this).next(".expandingBlock");"none"==a.css("display")?(a.slideDown("fast"),a.css("display","block")):(a.slideUp("fast"),setTimeout(function(){a.css("display","none")},500))}var o=function(a){this.hashtagCollection=a};function h(a,t){return $.ajax({url:"/api/v2/help_center/articles/"+t+"/labels/"+a+".json",type:"DELETE"})}o.prototype.initEvents=function(){$(".hashtag").on("click",function(){var d=$(this);d.attr("disabled","disabled");var c=$(this).parent(),a=$(this).attr("data-name");c.find("table").is(":visible")?(c.find("div").slideUp(),c.children("i").addClass("fa-caret-right").removeClass("fa-caret-down")):c.find("table").length?(c.find("div").slideDown(),c.children("i").removeClass("fa-caret-right").addClass("fa-caret-down")):$.get("/api/v2/help_center/articles/search.json?label_names=Tags:"+a).done(function(a){var t=a.results,s="<table><tr><th>Article Title</th><th>Tags</th></tr>";t.forEach(function(a){var t=!1,e="";a.label_names.forEach(function(a){"Tags:"===a.substr(0,5)&&(t=!0,e+='<div class="hashtag-container"><a class="article-label"><i class="fa fa-ellipsis-v hashtag-actions" aria-hidden="true"></i><span>#'+a.substr(5)+"</span></a></div>")}),t&&(s+='<tr id="'+a.id+'"><td><a href="/hc/en-us/articles/'+a.id+'">'+a.name+'</a></td><td><a class="add-hashtag-button"><i class="fa fa-plus" aria-hidden="true">New</i></a>'+e+"</td></tr>")}),s+="</table",c.children("i").removeClass("fa-caret-right").addClass("fa-caret-down"),c.children("div").append(s).slideDown(),d.removeAttr("disabled");var n,e=document.getElementById("add-hashtag-modal"),i=document.getElementsByClassName("hashtag-close-modal")[0],l=document.getElementById("cancel-add-hashtag"),o=document.getElementById("save-hashtag-button");$(".add-hashtag-button").on("click",function(){e.style.display="block",n=$(this).closest("tr").attr("id")}),i.onclick=function(){e.style.display="none"},$(".hashtag-close-modal, #cancel-delete-hashtag").on("click",function(){document.getElementById("delete-hashtag-modal").style.display="none"}),$(".hashtag-close-modal, #cancel-edit-hashtag").on("click",function(){document.getElementById("edit-hashtag-modal").style.display="none"}),l.onclick=function(){e.style.display="none"},o.onclick=function(){var a,t,e=document.getElementById("add-hashtag-input").value;(a=n,t=e,$.ajax({url:"/api/v2/help_center/articles/"+a+"/labels.json",type:"POST",data:{label:{name:"Tags:"+t}}})).done(function(){document.getElementById("add-hashtag-modal").style.display="none",$(".add-hashtag-button").parent().append('<a class="article-label"><i class="fa fa-ellipsis-v hashtag-actions" aria-hidden="true"></i><span>#'+e+"</span></a>")})},window.onclick=function(a){a.target==e&&(e.style.display="none"),a.target==document.getElementById("delete-hashtag-modal")&&(document.getElementById("delete-hashtag-modal").style.display="none"),a.target==document.getElementById("edit-hashtag-modal")&&(document.getElementById("edit-hashtag-modal").style.display="none")},$(".hashtag-actions").on("click",function(){var i=$(this),l=i.closest("tr").attr("id"),o=i.parent().text().substr(1);$(this).parent().parent().find(".hastag-actions-container").is(":visible")?($(this).parent().parent().find(".hastag-actions-container").remove(),$(this).css({color:"#ffffff",background:"#4986e7"})):($(".hastag-actions-container").remove(),$(".hashtag-actions").css({color:"#ffffff",background:"#4986e7"}),$(this).css({color:"#2e64f8",background:"#ffffff"}),$(this).parent().parent().append('<div class="hastag-actions-container" role="menu"><button id="edit-hashtag-option">Edit</button><br><button id="delete-hashtag-option" >Delete</button><div>'),$("#delete-hashtag-option").on("click",function(){i.css({color:"#ffffff",background:"#4986e7"}),$(".hastag-actions-container").remove(),$("#delete-hashtag-modal").css("display","block")}),$("#delete-hashtag-button").on("click",function(){var s;$.get("/api/v2/help_center/articles/"+l+"/labels.json").done(function(a){for(var t=0,e=a.labels.length;t<e;t++)if(o===a.labels[t].name.substr(5)){s=a.labels[t].id;break}h(s,l).done(function(){document.getElementById("delete-hashtag-modal").style.display="none",i.parent().remove()})})}),$("#edit-hashtag-option").on("click",function(){i.css({color:"#ffffff",background:"#4986e7"}),$(".hastag-actions-container").remove();var a=document.getElementById("edit-hashtag-modal");a.style.display="block",$(a).find("input").val(o)}),$("#edit-hashtag-button").on("click",function(){var s,a=document.getElementById("edit-hashtag-modal"),n=$(a).find("input").val();$.ajax({url:"/api/v2/help_center/articles/"+l+"/labels.json",type:"POST",data:{label:{name:"Tags:"+n}}}).done(function(){$.get("/api/v2/help_center/articles/"+l+"/labels.json").done(function(a){for(var t=0,e=a.labels.length;t<e;t++)if(o===a.labels[t].name.substr(5)){s=a.labels[t].id;break}h(s,l).done(function(){document.getElementById("edit-hashtag-modal").style.display="none",i.parent().find("span").text(n)})})})}))}),$(".hashtag-actions").mouseenter(function(){$(this).css({color:"#2e64f8",background:"#ffffff"}).mouseleave(function(){$(this).parent().parent().find(".hastag-actions-container").is(":visible")||$(this).css({color:"#ffffff",background:"#4986e7"})})})})})},o.prototype.render=function(){var t=[],e=[],s="";this.hashtagCollection.hashtags.forEach(function(a){t.push(a.name.substr(5).toLowerCase()),-1==$.inArray(a,e)&&e.push(a.name.substr(5))}),e.sort(),n.forEach(function(a){}),e.forEach(function(a){s+='<li id="'+a+'"><i class="fa fa-caret-right" aria-hidden="true"></i><a data-name="'+a+'" class="hashtag">#'+a+'</a><span class="label label-inverse">0</span><div></div></li>'}),$(".hashtag-count").append("<label>Hashtag Count: "+t.length+"</label>"),$(".hashtag-list").append(s)};var c=function(){this.hashtags=[]};c.prototype.add=function(a){this.hashtags.push(a)},c.prototype.addHashtags=function(a){this.hashtags=this.hashtags.concat(a)}});