$(document).ready(function(){var u,p,a=HelpCenter.user.role,e=(window.location.href.split("--")[0],"https://support.sizmek.com/hc/en-us/articles/360004850231-Hashtag-Management"),o=[],d=[],c=0;if(-1!==jQuery.inArray("view_support_content",HelpCenter.user.tags)&&$("#user-menu").append("<a id='hashAdmin' role='menuitem' href='"+e+"'>Hashtag Management</a>"),-1<window.location.href.indexOf("/articles/")&&"end_user"!=a&&"anonymous"!=a){var s,n,h=window.location.href.split("articles/")[1].split("#")[0].split("-")[0].split("?")[0];-1!==jQuery.inArray("view_support_content",HelpCenter.user.tags)&&($.get("/api/v2/help_center/articles/"+h+".json",function(a){n=a.article.section_id,$.get("/api/v2/help_center/sections/"+n+".json",function(a){g(s=a.section.category_id,n)})}),$(".article-wrapper").prepend('<div class="incident-wrapper"></div>'),$(".incident-wrapper").prepend('<div class="article-hashtags"></div>'),$("body").on("click","#hashBtn",function(){var a,e=[];$("#hashTxt").toggle("fast"),$("#hashTxt").focus(),""!=(a=$("#hashTxt").val().replace(/\s/g,""))&&(e.push(a),$("#hashTxt").val(""));for(var t=0;t<e.length;t++)$.ajax({url:"/api/v2/help_center/articles/"+h+"/labels.json",type:"POST",data:{label:{name:"Tags:"+e[t]}},success:function(){$(".tagList").remove(),$(".tagList").html(g(s,n)),$("#hashTxt").css("display","inline-block").focus()}})}),$("body").keypress(function(a){if(13===a.which&&"inline-block"===$("#hashTxt").css("display"))return $("#hashBtn").trigger("click"),!1}),$("body").on("click",".cssCircle.minusSign",function(a){a.stopPropagation();var e=$(this).find("span.hide").text();$("#query").val(""),$.ajax({url:"/api/v2/help_center/articles/"+h+"/labels/"+e+".json",type:"DELETE",success:function(){$(".tagList").remove(),$(".tagList").html(g(s,n))}})}),$("body").on("click","a.hashTags",function(){var a=$(this).find(".tagName:first").text();$("#query").val(a),$("#query").focus(),window.location.href="https://support.sizmek.com/hc/en-us/search?utf8=%E2%9C%93&query="+encodeURIComponent(a)+"&commit=Search"}),window.location.href==e&&($(".incident-wrapper, article, #query").hide(),$("#main-wrap").append('<section class="hashtag-management"> <div class="hashtag-count-container"> <div class="hashtag-count-icon"><i class="fa fa-tags" aria-hidden="true"></i></div><div class="hashtag-count"> <div><label id="number-hashtags"></label></div><div><label class="hashtag-label">Number of Hashtags</label></div></div></div><div class="hashtag-num-articles"><button id="show-hashtag-articles">Show Count<i class="fa fa-spinner"></i></button></div><div class="hashtag-sorting"> <select id="hashtag-select"> <option value="1">Latest Update</option> <option value="2">Alphabet</option> <option value="3">Number of Tags</option> </select> </div><div class="main-hashtagList-container"> <ul class="hashtag-list"></ul> </div><div id="add-hashtag-modal" class="modal"> <div class="modal-content"> <div class="hashtag-modal-header"> <h4>Add hashtag</h4><span class="hashtag-close-modal">&times;</span> </div><div class="hashtag-modal-body"> <form> <div> <label>Hashtag</label> <input id="add-hashtag-input" spellcheck="false"> <p></p></div></form> </div><div class="hashtag-modal-footer"> <button id="cancel-add-hashtag"> <span>Cancel</span></button> <button id="save-hashtag-button"><span>OK</span></button> </div></div></div><div id="edit-hashtag-modal" class="modal"> <div class="modal-content"> <div class="hashtag-modal-header"> <h4>Edit hashtag</h4><span class="hashtag-close-modal">&times;</span> </div><div class="hashtag-modal-body"> <form> <div> <label>Hashtag</label> <input id="edit-hashtag-input" spellcheck="false"> <p></p></div></form> </div><div class="hashtag-modal-footer"> <button id="cancel-edit-hashtag"><span>Cancel</span></button> <button id="edit-hashtag-button"><span>OK</span></button> </div></div></div><div id="delete-hashtag-modal" class="modal"> <div class="modal-content"> <div class="hashtag-modal-header"> <h4>Delete hashtag</h4><span class="hashtag-close-modal">&times;</span> </div><div class="hashtag-modal-body"> <form> <h4>Do you want to delete this hashtag?</h4> </form> </div><div class="hashtag-modal-footer"> <button id="cancel-delete-hashtag"><span>Cancel</span></button> <button id="delete-hashtag-button"><span>OK</span></button> </div></div></div></section>'),$('<div class="hashtagHeader"></div>').insertAfter(".article-info"),$('<div class="hashtagList body"></div>').insertAfter(".hashtagHeader"),$(".hashtagHeader").append("<div class='searchContainer' style='float: right;'><input id='sortTagBtn' type='button' value='Sort tags by...'></div>"),$(".searchContainer").append("<div class='sortOptions' style='display: none;'></div>"),$.get("/api/v2/help_center/articles/labels").done(function(a){var s=0,n="";a.labels.forEach(function(a){var e=a.name;if("Tags:"===e.substr(0,5)&&"Tags:"!==e){o.push(a),s++;var t=e.substr(5);n+='<li id="'+t+'"><i class="fa fa-caret-right" aria-hidden="true"></i><a data-name="'+t+'" class="hashtag">#'+t+'</a><a><span class="label label-inverse">0</span></a><div></div></li>'}}),$("#number-hashtags").text(s),$(".hashtag-list").append(n),allHashtaglen=o.length,v(),$("#show-hashtag-articles").on("click",function(){var a=$(this).children("i");a.css("display","inline-block").toggleClass("fa-spin"),$("#hashtag-select").parent().css("margin-right","-110px"),$(this).css("pointer-events","none"),d.length?($(".hashtag-list .label-inverse").css("display","inline-block"),$(this).css("pointer-events","auto"),a.hide()):m(!1)})}),document.getElementById("hashtag-select").addEventListener("change",function(){r(this.value)}),$("body").on("click",".h3Tag",t),$("body").keypress(function(a){if(13===a.which&&1==$("#searchTag").is(":focus")&&""!=$("#searchTag").val()){var e=$(".tag-"+$("#searchTag").val());return $("html,body").animate({scrollTop:e.offset().top},500),$("body").on("click",".h3Tag",t),!1}})))}function i(a,e){return a.name.substr(5).toLowerCase()<e.name.substr(5).toLowerCase()?-1:a.name.substr(5).toLowerCase()>e.name.substr(5).toLowerCase()?1:0}function l(a,e){return a.hashtag.name.substr(5).toLowerCase()<e.hashtag.name.substr(5).toLowerCase()?-1:a.hashtag.name.substr(5).toLowerCase()>e.hashtag.name.substr(5).toLowerCase()?1:0}function r(a){if(d.length)var e=d.slice(0);else e=o.slice(0);function t(){var a=document.getElementsByClassName("hashtag-list"),s="",n=!1;a[0].innerHTML="",e.forEach(function(a){if(d.length)var e=a.hashtag.name.substr(5);else e=a.name.substr(5);var t=0;a.articlesCount&&(t=a.articlesCount,n=!0),s+='<li id="'+e+'"><i class="fa fa-caret-right" aria-hidden="true"></i><a data-name="'+e+'" class="hashtag">#'+e+'</a><a><span class="label label-inverse">'+t+"</span></a><div></div></li>"}),$("#number-hashtags").text(o.length),$(".hashtag-list").append(s),n&&$(".hashtag-list .label").css("display","inline-block")}1==a?(t(),v()):2==a?(d.length?e.sort(l):e.sort(i),t(),v()):3==a&&(d.length?((e=d.slice(0)).sort(function(a,e){return a.articlesCount-e.articlesCount}),e.reverse(),t(),v()):m(!0))}function g(l,a){var i,o=[];$(".article-hashtags").append('<div class="tagList"><a id="hashBtn" style="font-weight: bold;">+</a><input list="recoHashtag" type="text" id="hashTxt" placeholder="Enter a term, keyword or tag..." style="display: none; margin: 0px 7px;"><datalist id="recoHashtag"></datalist></div>'),$(".article-body.markdown p").append('<div class="hidden-tags hide"><ul></ul></div>'),$.get("/api/v2/help_center/articles/"+h+"/labels.json",function(t){var a=1,e=window.localStorage,s=window.location.href.split("?currArticleId=")[1];if(-1<window.location.href.indexOf("/208223316")&&null!==e.getItem(HelpCenter.user.email+"-previewLabels"+s)){var n=e.getItem(HelpCenter.user.email+"-previewLabels"+s).split(",");t.labels=[],$.each(n,function(a,e){t.labels.push({name:e})})}for(var i=0;i<t.labels.length;i++)"Tags:"==t.labels[i].name.substr(0,5)&&($('<a class="hashTags" id="hash-'+a+'"><div class="cssCircle minusSign" style="display: none; background: #ff0000;">&#8211;<span class="hide">'+t.labels[i].id+'</span></div><div class="tagName">#'+t.labels[i].name.substr(5)+'</div><span class="hide">'+l+"</span></a>").insertAfter("#recoHashtag"),$(".hidden-tags ul").append("<li>"+t.labels[i].name+"</li>"),a++,o.push(t.labels[i].name.substr(5).toLowerCase()))}),i=o,$.get("/api/v2/help_center/categories/"+s+"/articles.json?sort_by=updated_at&sort_order=desc",function(a){for(var e=[],t=0;t<a.articles.length;t++)for(var s=0;s<a.articles[t].label_names.length;s++)"Tags:"==a.articles[t].label_names[s].substr(0,5)&&e.push(a.articles[t].label_names[s].substr(5).toLowerCase());var e=e.filter(function(a){return!this.has(a)},new Set(i)),n=[];$.each(e,function(a,e){-1==$.inArray(e,n)&&n.push(e)});for(var t=0;t<n.length;t++)$("#recoHashtag").append('<option value="'+n[t]+'"/>')})}function t(){var a=$(this).next(".expandingBlock");"none"==a.css("display")?(a.slideDown("fast"),a.css("display","block")):(a.slideUp("fast"),setTimeout(function(){a.css("display","none")},500))}function m(e){var l=o[c].name;$.ajax({url:"/api/v2/help_center/articles/search.json?label_names="+l+"&per_page=100",async:!0,dataType:"jsonp"}).done(function(a){var t=a.results,s=a.next_page,n=0;if(a.count<100)1===a.count?(n=1,$("#"+l.substr(5)).find(".label-inverse").text("1").css("display","inline-block")):(t.forEach(function(a){a.label_names.includes(l)&&n++}),$("#"+l.substr(5)).find(".label-inverse").text(n).css("display","inline-block")),i();else if(s){!function e(){$.ajax({url:s,async:!0,dataType:"jsonp"}).done(function(a){s=a.next_page,t=t.concat(a.results),s?e():(t.forEach(function(a){a.label_names.includes(l)&&n++}),$("#"+l.substr(5)).find(".label-inverse").text(n).css("display","inline-block"),i())})}()}function i(){d.push({hashtag:o[c],articlesCount:n,hashtagData:t}),++c<allHashtaglen?m():(e&&r(3),$("#show-hashtag-articles").children("i").hide(),$("#hashtag-select").parent().css("margin-right","-140px"))}})}function v(){$(".hashtag").on("click",function(){var c=$(this),h=c.parent(),r=c.attr("data-name");h.find("table").is(":visible")?(h.find("div").slideUp(),h.children("i").addClass("fa-caret-right").removeClass("fa-caret-down")):h.find("table").length?(h.find("div").slideDown(),h.children("i").removeClass("fa-caret-right").addClass("fa-caret-down")):(c.css("pointer-events","none"),$.get("/api/v2/help_center/articles/search.json?label_names=Tags:"+r+"&per_page=100").done(function(a){var n,e=a.results,s="<table><tr><th>Article Title</th><th></th><th>Tags</th></tr>";e.forEach(function(a){if(a.label_names.includes("Tags:"+r)){var e=!1,t="";a.label_names.forEach(function(a){"Tags:"===a.substr(0,5)&&(e=!0,t+='<div class="hashtag-container"><a class="article-label"><i class="fa fa-pencil edit-hashtag-option" aria-hidden="true"></i><span>#'+a.substr(5)+'</span><i class="fa fa-trash delete-hashtag-option" aria-hidden="true"></i></a></div>')}),e&&(s+='<tr id="'+a.id+'"><td><a href="/hc/en-us/articles/'+a.id+'">'+a.name+'</a></td><td><a class="add-hashtag-button"><i class="fa fa-plus" aria-hidden="true">New</i></a></td><td>'+t+"</td></tr>")}}),s+="</table",h.children("i").removeClass("fa-caret-right").addClass("fa-caret-down"),h.children("div").append(s).slideDown(),c.css("pointer-events","auto");var i,t=document.getElementById("add-hashtag-modal"),l=document.getElementsByClassName("hashtag-close-modal")[0],o=document.getElementById("cancel-add-hashtag"),d=document.getElementById("save-hashtag-button");$(".add-hashtag-button").on("click",function(){t.style.display="block",i=$(this).closest("tr").attr("id")}),l.onclick=function(){t.style.display="none"},$(".hashtag-close-modal, #cancel-delete-hashtag").on("click",function(){document.getElementById("delete-hashtag-modal").style.display="none"}),$(".hashtag-close-modal, #cancel-edit-hashtag").on("click",function(){document.getElementById("edit-hashtag-modal").style.display="none"}),o.onclick=function(){t.style.display="none"},d.onclick=function(){var a,e,t=document.getElementById("add-hashtag-input").value;(a=i,e=t,$.ajax({url:"/api/v2/help_center/articles/"+a+"/labels.json",type:"POST",data:{label:{name:"Tags:"+e}}})).done(function(){document.getElementById("add-hashtag-modal").style.display="none",setTimeout(function(){location.reload()},100)})},window.onclick=function(a){a.target==t&&(t.style.display="none"),a.target==document.getElementById("delete-hashtag-modal")&&(document.getElementById("delete-hashtag-modal").style.display="none"),a.target==document.getElementById("edit-hashtag-modal")&&(document.getElementById("edit-hashtag-modal").style.display="none")},$(".delete-hashtag-option").on("click",function(){$("#delete-hashtag-modal").css("display","block"),u=$(this).closest("tr").attr("id"),p=$(this).parent().children("span").text().substr(1),n=$(this).parent()}),$("#delete-hashtag-button").on("click",function(){var s;$.get("/api/v2/help_center/articles/"+u+"/labels.json").done(function(a){for(var e=0,t=a.labels.length;e<t;e++)if(p===a.labels[e].name.substr(5)){s=a.labels[e].id;break}f(u,s).done(function(){document.getElementById("delete-hashtag-modal").style.display="none",n.remove()})})}),$(".edit-hashtag-option").on("click",function(){p=$(this).parent().children("span").text().substr(1);var a=document.getElementById("edit-hashtag-modal");a.style.display="block",u=$(this).closest("tr").attr("id"),$(a).find("input").val(p)}),$("#edit-hashtag-button").on("click",function(){var s,a=document.getElementById("edit-hashtag-modal"),e=$(a).find("input").val();$.ajax({url:"/api/v2/help_center/articles/"+u+"/labels.json",type:"POST",data:{label:{name:"Tags:"+e}}}).done(function(){$.get("/api/v2/help_center/articles/"+u+"/labels.json").done(function(a){for(var e=0,t=a.labels.length;e<t;e++)if(p===a.labels[e].name.substr(5)){s=a.labels[e].id;break}f(u,s).done(function(){document.getElementById("edit-hashtag-modal").style.display="none",location.reload()})})})})}))})}function f(a,e){return $.ajax({url:"/api/v2/help_center/articles/"+a+"/labels/"+e+".json",type:"DELETE"})}});